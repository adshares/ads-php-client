<?php

namespace Adshares\Ads\Tests\Unit\Entity;

use \Adshares\Ads\Entity\Block;
use Adshares\Ads\Entity\Node;

class BlockTest extends \PHPUnit\Framework\TestCase
{
    public function testCreateFromRow()
    {
        /* @var Block $block */
        $block = Block::createFromRaw($this->getRawBlock1());

        $this->assertEquals("5B3A1E80", $block->getId());
        $this->assertInternalType('string', $block->getId());

        $nodes = $block->getNodes();
        /* @var Node $node */
        $node = $nodes[1];
        $this->assertInstanceOf(Node::class, $node);
        $this->assertEquals(254152169691701433, $node->getBalance());
    }

    private function getRawBlock1()
    {
        return json_decode('{
		"id": "5B3A1E80",
		"time": "1530535552",
		"message_count": "27",
		"oldhash": "91655C4B8EA51E66E81F079A8C520EBB9097A44D74EEFC310C79BEDABC4204EF",
		"minhash": "41FB7933B8BE623E0D8C087E0AAC91F56999AB892ED1DC9B1DCB39D057427639",
		"msghash": "F41152F6FDB5C50697B1BCF8562F35848C7D679CAC8A69883341FF55040B684B",
		"nodhash": "DEE608AFF65371FD14AC7118528BAAAF620931B2B261E5964C632B908D1C57EA",
		"viphash": "23A7002738367EC99A7BD2988720FF0824580219D2502226084E1BCE11A0B634",
		"nowhash": "DDD2F343184A8BFF7FC9DE1704B9956D89B0573D7C27FE1F55D9646470B8B12C",
		"vote_yes": "0",
		"vote_no": "0",
		"vote_total": "7",
		"node_count": "21",
		"dividend_balance": "0.00000000000",
		"dividend_pay": "true",
		"nodes": [{
				"id": "0000",
				"public_key": "0000000000000000000000000000000000000000000000000000000000000000",
				"hash": "0000000000000000000000000000000000000000000000000000000000000000",
				"message_hash": "D18D1A21A546508BE4F2B5EF6F51981D7D2B55E46EE2EF1DE6911F8E9B2AD84D",
				"msid": "0",
				"mtim": "1530535488",
				"balance": "0.00000000000",
				"status": "0",
				"account_count": "0",
				"port": "0",
				"ipv4": "0.0.0.0"
			}, {
				"id": "0001",
				"public_key": "73A5C92FA5142599B1C9863B43E026AFEFA6B57AEE8D189241C7F50C90BA5122",
				"hash": "B1C1E0BF92C7C398BD885269F6912EFC22810477065E8C5BF6B5AC8DC05FEC1F",
				"message_hash": "14AC6CA024A5FBF06251554849BD9B9521B348A63DBEAE57E59DC4C85E00B64A",
				"msid": "8",
				"mtim": "1530535574",
				"balance": "2541521.69691701433",
				"status": "6",
				"account_count": "20",
				"port": "8001",
				"ipv4": "172.16.222.101"
			}, {
				"id": "0002",
				"public_key": "FC4CA38301AC2080ADA2BC08C4A94405E546B659BD2EB559C1520A55586336CD",
				"hash": "4E103B1EB3DA35C68CB5C846237956E99131A085C7822BE6745541569141921A",
				"message_hash": "2E35698B8694BB0F679DE02C4772CEAF0D3F9B30EA12C7964589B05B0C9FC46C",
				"msid": "8",
				"mtim": "1530535576",
				"balance": "2477983.66213414626",
				"status": "2",
				"account_count": "20",
				"port": "8002",
				"ipv4": "172.16.222.101"
			}, {
				"id": "0003",
				"public_key": "5138AA57FAF5F7F2E67BDCA14F3CC377CD4C681B3F8B5A41DDDD590BD36C3125",
				"hash": "EE13E20B4306500AF75237476DB0402654E2DA4003F15249120A4FB8D0CE0289",
				"message_hash": "8AE62B3CB3A635A7813679EC36498DBB2747A176B0CCAD360ED72D789B40156E",
				"msid": "1",
				"mtim": "1530535524",
				"balance": "2414445.61951148890",
				"status": "2",
				"account_count": "20",
				"port": "8003",
				"ipv4": "172.16.222.101"
			}, {
				"id": "0004",
				"public_key": "BB6D774EA23DFB4D6510F04EFFA79FCA281C046CB39143B101CB451D0919AFA9",
				"hash": "BF9859930706EFD70CE26A1FDBC7CB672EBE827F74AB1E3A2922B74B93A5871A",
				"message_hash": "1F423936DC75E0E3FC9C5C8FC447617860156C75A4A0A290F36FBFC7353280DA",
				"msid": "7",
				"mtim": "1530535576",
				"balance": "2350907.57688828675",
				"status": "2",
				"account_count": "20",
				"port": "8004",
				"ipv4": "172.16.222.101"
			}, {
				"id": "0005",
				"public_key": "BCEEFF93B281A5FB95B3F05922DC3D9B4BDE91FC8116C340068F778CA16F2564",
				"hash": "5B66A894A2826A642D68999AFD1BE8BD7238E82B25C5AE567EE8F18C092AB1BE",
				"message_hash": "EBFE2968B92DF8622D22C8CBFE750232AB68265DA117303442E249219C2241A4",
				"msid": "1",
				"mtim": "1530535524",
				"balance": "2287369.53426558728",
				"status": "2",
				"account_count": "20",
				"port": "8005",
				"ipv4": "172.16.222.101"
			}, {
				"id": "0006",
				"public_key": "3A1969E7A8F418537CBCBEDB8FDC8E4C5B4D78C4D73970B9E2739055FF4E883E",
				"hash": "F021090C574542CCB8EAD86A24CE1C2A228B978DDD8AE8D3D80528162B2E82D7",
				"message_hash": "4EE1E40F4768777560242B09DE3DE93067899B333688D9D9BDC261E0E628D99B",
				"msid": "7",
				"mtim": "1530535574",
				"balance": "2223831.49164238500",
				"status": "2",
				"account_count": "20",
				"port": "8006",
				"ipv4": "172.16.222.101"
			}, {
				"id": "0007",
				"public_key": "64938E054C70E26F37E56474B20E78691ACE89A441018041FDFFAC2B224BE55C",
				"hash": "AFCC3738145F5E59F53FC36389144A78C59D9ECCC39609331A5F0932FA2F1F4E",
				"message_hash": "0EC5223271DABDE8C08FC618AF01C2B006DE911170B11BD15073ACB9BDF00201",
				"msid": "2",
				"mtim": "1530535530",
				"balance": "2160293.44901964379",
				"status": "2",
				"account_count": "20",
				"port": "8007",
				"ipv4": "172.16.222.101"
			}, {
				"id": "0008",
				"public_key": "DE5C6E34A1E694E5B5FA497CD488685FFBED0CCA3A840094AB0631EBD250ADC0",
				"hash": "01B6F4F406614B9C2A9D8CAF2A15DBCC357F003B6E13576BB0652FD118A16F48",
				"message_hash": "61C7CDBA1DEAD2CA2B8090EE6EFF86EEFE840ED86BCC4945B6529C1664C0B2D1",
				"msid": "6",
				"mtim": "1530535570",
				"balance": "2096755.40639652523",
				"status": "0",
				"account_count": "20",
				"port": "8008",
				"ipv4": "172.16.222.101"
			}, {
				"id": "0009",
				"public_key": "1C726BFC7B795B71B6FEBB084157DE14C60379C80EFC903CC8783C733C2AD3D4",
				"hash": "7A720CDD007996DC440EF0C93E3FCD538CC404E4647B0B5FB26DD5D21DE29AFB",
				"message_hash": "69E3A6239D85CE81F8740A0A32DA23A82BEED104EABC5FFC52E10513049D476F",
				"msid": "1",
				"mtim": "1530535524",
				"balance": "2033217.36377378407",
				"status": "0",
				"account_count": "20",
				"port": "8009",
				"ipv4": "172.16.222.101"
			}, {
				"id": "000A",
				"public_key": "3D22D7095007382ADD6F9530100F3F5FC42E82FE79FC69726B3F95E57C558C3F",
				"hash": "76A6C00BC74382178AE19EB51317BDF3FCC808D985AB59D7BBC8F126BB07F424",
				"message_hash": "5891D60DA45A2EA828373FCB52D47B82123A73D2F5234368D9C73CFA2D5A0CDE",
				"msid": "5",
				"mtim": "1530535574",
				"balance": "1969679.32115066517",
				"status": "0",
				"account_count": "20",
				"port": "8010",
				"ipv4": "172.16.222.101"
			}, {
				"id": "000B",
				"public_key": "0D2AF8139E9BB7C0A0A80EEB1A37A9F444B814B00D0DF23960BE919F1CC3FF0E",
				"hash": "A3F0AE3495C6AD4A9B7FB2E25EF3C416FE82B8A7F77AA278BF5F14C6E4D9B233",
				"message_hash": "B0E30A96BC1FB136CD8693E4DA120CAD2182B89C53A3A079B8C231D14F7B47C4",
				"msid": "1",
				"mtim": "1530535524",
				"balance": "1906141.27852788245",
				"status": "0",
				"account_count": "20",
				"port": "8011",
				"ipv4": "172.16.222.101"
			}, {
				"id": "000C",
				"public_key": "D42C1FCF2A0E9EE57ADCE93F10F033000AC2691FFC76E14CF88C28932AC6ED99",
				"hash": "6FF3BF276C4DB4CF25E4E27B340FA83D75AFD65E776344776772AC4D9D35E692",
				"message_hash": "8931AF6E9CAB15FA569290A03BA4D29AC494D458D83C00123BB08B539B6A0CC2",
				"msid": "3",
				"mtim": "1530535574",
				"balance": "1842603.23590484762",
				"status": "0",
				"account_count": "20",
				"port": "8012",
				"ipv4": "172.16.222.101"
			}, {
				"id": "000D",
				"public_key": "079F0B36180C3750C72D784F91A9EB8416E535893547D777E4C0C7A5E90D428F",
				"hash": "AD5E9215E2AA0DD65F5AB3FDCB44DF06E41E551F40BAC90BA4E3BC81C3276952",
				"message_hash": "0A6D472D9C39308A11A65EDAD9BFB481ADB02CB008504228A3CD21941492794F",
				"msid": "1",
				"mtim": "1530535524",
				"balance": "1779065.19328198083",
				"status": "0",
				"account_count": "20",
				"port": "8013",
				"ipv4": "172.16.222.101"
			}, {
				"id": "000E",
				"public_key": "3B290107659C370BA8F60F1EA5A53A5F540551CEDB219127CFECA832E6860A09",
				"hash": "9EB830E94A000B635A3C7A23104CB4C2DE8660E52ED2B8BD4937A7F96DB8B6F9",
				"message_hash": "64558190604C7CEF4D428467B0F0008B1E94B96FEE3BC86A3E2CDCA56A17F358",
				"msid": "3",
				"mtim": "1530535568",
				"balance": "1715527.15065894611",
				"status": "0",
				"account_count": "20",
				"port": "8014",
				"ipv4": "172.16.222.101"
			}, {
				"id": "000F",
				"public_key": "2DEA0AC8FE9CBACCB369D08D2F9F083BAE7F62BFAC103FCFEDB71C43500E8CC8",
				"hash": "90709EA26BF684E6D9F922B0178BDB7033980C5BA3E5C9238E5F8A62053E3088",
				"message_hash": "FFCCE60A7F551B158045DE9B15C04A26DC970C89254CF65CE69AFD832907E20A",
				"msid": "1",
				"mtim": "1530535524",
				"balance": "1651989.10803607921",
				"status": "0",
				"account_count": "20",
				"port": "8015",
				"ipv4": "172.16.222.101"
			}, {
				"id": "0010",
				"public_key": "D7F0A15F85B81F4B076FB3A0D9BCF19FA3E18FB0CC0D19D771F1306568CDF6DF",
				"hash": "D0A2399E116F18ACF1E9733A86FB838B9E7DE76E61ED141B5E77228055F96501",
				"message_hash": "7AAB0D005E18BC2E09C74AC7BD2A21108EC7BD70C6DDC6E52187337076075C0B",
				"msid": "7",
				"mtim": "1530535576",
				"balance": "1588451.06541287663",
				"status": "0",
				"account_count": "20",
				"port": "8016",
				"ipv4": "172.16.222.101"
			}, {
				"id": "0011",
				"public_key": "5532A85D227C45B81C8E52C3EE05221965EB69F6F75DF5E9BB142F6FE4C50A24",
				"hash": "37B99C6136E20DD23F40B2D0EC3B2A7E599D2EC678EC49D5E48FB52D79836CF0",
				"message_hash": "862870ED2FCCAC1D717984FB16AF5A221890963CB661D598A59A26D0FC2C4B7B",
				"msid": "1",
				"mtim": "1530535524",
				"balance": "1524913.02279017759",
				"status": "0",
				"account_count": "20",
				"port": "8017",
				"ipv4": "172.16.222.101"
			}, {
				"id": "0012",
				"public_key": "9EA9E4D51C0F105CED871B8FE847DAF2C541E29DD89FE33527BE2B0EDB701BC0",
				"hash": "345FDCAFD621510C678A62087354290B952D6142A24E6DD0E4E8ACDB26EE83F1",
				"message_hash": "8FF61B389D0DC7A61691B7C39B543778D9D5A795F66C692C36EFC345BA524B5E",
				"msid": "5",
				"mtim": "1530535564",
				"balance": "1461374.98016705888",
				"status": "0",
				"account_count": "20",
				"port": "8018",
				"ipv4": "172.16.222.101"
			}, {
				"id": "0013",
				"public_key": "50F6C24AC6D1583948F1A4E721CE06B12F441641E775B45713D5C52DF6CEDF0C",
				"hash": "0E91C5AD4BDE48EB79E5FDC36762DB793C9484DE2C4604BBDAB14103EDA9A406",
				"message_hash": "CED2C67050088DAF5EBEADB70AD0AF2EF976F3D4F296EAC991E2760B92BA4C4B",
				"msid": "1",
				"mtim": "1530535524",
				"balance": "1397836.93754427597",
				"status": "0",
				"account_count": "20",
				"port": "8019",
				"ipv4": "172.16.222.101"
			}, {
				"id": "0014",
				"public_key": "5DE0DD1FA563C3FBDEC9802E681968261C9734D9029F7F7EA9A15251337E34CC",
				"hash": "66E4D0817FFD87152147BC63564AE5BA99C5F7CBDFC9A19F2CDDC224B700B030",
				"message_hash": "97E1559BB1CD30F38CF52E645695874B3D82D8653EC33D7652D831EC166ABD4D",
				"msid": "4",
				"mtim": "1530535556",
				"balance": "1334298.89492119939",
				"status": "0",
				"account_count": "20",
				"port": "8020",
				"ipv4": "172.16.222.101"
			}
		]
	}', true);
    }
}
